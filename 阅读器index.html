<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-Bunny 阅读屋</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            color: #3a332e;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            transition: background-image 0.8s ease;
            background-color: #f8f5f2;
        }
        
        /* 全屏背景覆盖 */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
        }
        
        /* 默认斑点背景 */
        body.default-bg::before {
            background-image: radial-gradient(#d7ccc8 2px, transparent 2px);
            background-size: 30px 30px;
            opacity: 0.3;
        }
        
        /* 自定义背景图片 */
        body.background-1::before {
            background-image: url('https://files.catbox.moe/nm0xpd.jpg');
        }
        
        body.background-2::before {
            background-image: url('https://files.catbox.moe/h5u246.jpg');
        }
        
        body.background-3::before {
            background-image: url('https://files.catbox.moe/e4e0eq.jpg');
        }
        
        body.background-1::before,
        body.background-2::before,
        body.background-3::before {
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* 头部和导航栏 - 简化设计 */
        header {
            padding: 20px 0 10px;
            position: sticky;
            top: 0;
            z-index: 100;
            transition: all 0.3s ease;
            background-color: transparent;
        }
        
        .nav-container {
            background: rgba(255, 253, 250, 0.9);
            backdrop-filter: blur(12px);
            border-radius: 20px;
            padding: 15px 25px;
            box-shadow: 0 4px 20px rgba(188, 170, 164, 0.25);
            border: 1px solid rgba(255, 253, 250, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1100px;
            margin: 0 auto;
            transition: all 0.3s ease;
        }
        
        /* 滚动时导航栏样式 */
        header.scrolled .nav-container {
            padding: 12px 20px;
            border-radius: 18px;
            box-shadow: 0 6px 25px rgba(188, 170, 164, 0.35);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #8d6e63;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            font-size: 26px;
        }
        
        .logo-icon {
            width: 45px;
            height: 45px;
            background: url('https://files.catbox.moe/bh6l0s.png') no-repeat center center;
            background-size: contain;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(161, 136, 127, 0.3);
            border-radius: 50%;
        }
        
        .nav-links {
            display: flex;
            gap: 25px;
        }
        
        .nav-links a {
            text-decoration: none;
            color: #6d4c41;
            font-weight: 500;
            font-size: 15px;
            padding: 8px 15px;
            border-radius: 20px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .nav-links a:hover {
            color: #8d6e63;
            background-color: rgba(161, 136, 127, 0.1);
        }
        
        .nav-links a.active {
            color: #8d6e63;
            background-color: rgba(161, 136, 127, 0.15);
        }
        
        /* 背景切换按钮 */
        .background-toggle {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 999;
            cursor: move;
            transition: opacity 0.3s;
        }
        
        .background-toggle.hidden {
            opacity: 0.3;
        }
        
        .bg-btn {
            width: 60px;
            height: 60px;
            background: rgba(120, 120, 120, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #f5f5f5;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(100, 100, 100, 0.4);
            border: 1px solid rgba(200, 200, 200, 0.3);
            transition: all 0.3s ease;
        }
        
        .bg-btn:hover {
            transform: scale(1.1);
            background: rgba(150, 150, 150, 0.9);
        }
        
        .background-panel {
            position: absolute;
            bottom: 70px;
            left: 0;
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(100, 100, 100, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.25);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease;
            display: none;
        }
        
        .background-panel.active {
            opacity: 1;
            transform: translateY(0);
            display: block;
        }
        
        .background-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .background-title {
            font-size: 20px;
            font-weight: 700;
            color: #555;
        }
        
        .background-close {
            background: none;
            border: none;
            font-size: 20px;
            color: #777;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .background-close:hover {
            color: #555;
        }
        
        .background-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .background-item {
            position: relative;
            height: 100px;
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .background-item:hover {
            transform: scale(1.05);
        }
        
        .background-item.active {
            border-color: #8d6e63;
            box-shadow: 0 0 0 2px rgba(141, 110, 97, 0.3);
        }
        
        .background-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .background-name {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            font-size: 12px;
            padding: 5px 8px;
            text-align: center;
            backdrop-filter: blur(5px);
        }
        
        .background-item.default-bg .background-preview {
            background: #f5f1ee;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #8d6e63;
            font-size: 30px;
        }
        
        /* 音乐播放器 */
        .music-player {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 999;
            cursor: move;
            transition: opacity 0.3s;
        }
        
        .music-player.hidden {
            opacity: 0.3;
        }
        
        .player-btn {
            width: 60px;
            height: 60px;
            background: rgba(120, 120, 120, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #f5f5f5;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(100, 100, 100, 0.4);
            border: 1px solid rgba(200, 200, 200, 0.3);
            transition: all 0.3s ease;
        }
        
        .player-btn:hover {
            transform: scale(1.1);
            background: rgba(150, 150, 150, 0.9);
        }
        
        .player-panel {
            position: absolute;
            bottom: 70px;
            right: 0;
            width: 320px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(100, 100, 100, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.25);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease;
            display: none;
        }
        
        .player-panel.active {
            opacity: 1;
            transform: translateY(0);
            display: block;
        }
        
        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .player-title {
            font-size: 20px;
            font-weight: 700;
            color: #555;
        }
        
        .player-close {
            background: none;
            border: none;
            font-size: 20px;
            color: #777;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .player-close:hover {
            color: #555;
        }
        
        .song-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .song-cover {
            width: 70px;
            height: 70px;
            border-radius: 15px;
            background: linear-gradient(135deg, #888, #aaa);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            box-shadow: 0 6px 15px rgba(100, 100, 100, 0.4);
            flex-shrink: 0;
        }
        
        .song-details h4 {
            font-size: 18px;
            color: #555;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .song-details p {
            color: #777;
            font-size: 14px;
        }
        
        .player-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .control-btn {
            background: none;
            border: none;
            font-size: 20px;
            color: #777;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .control-btn:hover {
            transform: scale(1.2);
            color: #555;
        }
        
        .play-pause {
            width: 50px;
            height: 50px;
            background: rgba(150, 150, 150, 0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .progress-container {
            background: rgba(150, 150, 150, 0.1);
            height: 6px;
            border-radius: 3px;
            margin-bottom: 25px;
            cursor: pointer;
        }
        
        .progress-bar {
            background: linear-gradient(to right, #888, #aaa);
            height: 100%;
            width: 0%;
            border-radius: 3px;
            transition: width 0.1s linear;
        }
        
        .upload-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(150, 150, 150, 0.4);
        }
        
        .upload-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 12px;
            background: rgba(200, 200, 200, 0.15);
            border: 2px dashed #aaa;
            border-radius: 15px;
            color: #666;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-btn:hover {
            background: rgba(200, 200, 200, 0.25);
            border-color: #888;
            color: #555;
        }
        
        .upload-btn i {
            font-size: 18px;
        }
        
        #file-input {
            display: none;
        }
        
        .upload-info {
            font-size: 12px;
            color: #999;
            text-align: center;
            margin-top: 8px;
        }
        
        .song-list {
            list-style: none;
            max-height: 200px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .song-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .song-list::-webkit-scrollbar-track {
            background: rgba(200, 200, 200, 0.2);
            border-radius: 10px;
        }
        
        .song-list::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        
        .song-item {
            padding: 12px 15px;
            border-radius: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s;
            cursor: pointer;
            color: #555;
        }
        
        .song-item:hover {
            background: rgba(150, 150, 150, 0.1);
        }
        
        .song-item.active {
            background: rgba(150, 150, 150, 0.15);
            color: #555;
        }
        
        .song-item .song-name {
            flex-grow: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-right: 10px;
        }
        
        .delete-song {
            background: none;
            border: none;
            color: #aaa;
            font-size: 14px;
            cursor: pointer;
            padding: 2px 5px;
            border-radius: 5px;
            transition: all 0.2s;
            opacity: 0.7;
        }
        
        .delete-song:hover {
            color: #888;
            opacity: 1;
        }
        
        /* 主要内容区域 */
        main {
            padding: 30px 0 100px;
        }
        
        .article-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 40px;
        }
        
        /* 首页阅读列表 */
        .reading-list-container {
            background: rgba(255, 253, 250, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(188, 170, 164, 0.25);
            border: 1px solid rgba(255, 253, 250, 0.3);
        }
        
        .reading-list-header {
            margin-bottom: 40px;
            text-align: center;
        }
        
        .reading-list-title {
            font-size: 32px;
            font-weight: 700;
            color: #8d6e63;
            margin-bottom: 10px;
        }
        
        .reading-list-subtitle {
            font-size: 18px;
            color: #6d4c41;
            font-weight: 300;
        }
        
        .reading-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 40px;
        }
        
        .reading-item {
            background: rgba(255, 253, 250, 0.95);
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(188, 170, 164, 0.25);
            transition: all 0.3s;
            border: 1px solid rgba(255, 253, 250, 0.4);
            cursor: pointer;
        }
        
        .reading-item:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 35px rgba(188, 170, 164, 0.35);
        }
        
        .reading-cover {
            height: 250px;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        
        .reading-cover::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(to top, rgba(0,0,0,0.5), transparent);
        }
        
        .reading-category {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(255, 253, 250, 0.95);
            color: #8d6e63;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .reading-content {
            padding: 25px;
        }
        
        .reading-title {
            font-size: 24px;
            font-weight: 700;
            color: #5d4037;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        .reading-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 13px;
            color: #8d6e63;
        }
        
        .reading-author {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .reading-author-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: url('https://files.catbox.moe/t020th.png') no-repeat center center;
            background-size: cover;
        }
        
        .reading-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .reading-action-btn {
            background: rgba(161, 136, 127, 0.15);
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            color: #8d6e63;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .reading-action-btn:hover {
            background: rgba(161, 136, 127, 0.25);
        }
        
        /* 文章区域 */
        .article-content {
            background: rgba(255, 253, 250, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(188, 170, 164, 0.25);
            border: 1px solid rgba(255, 253, 250, 0.3);
        }
        
        .article-header {
            margin-bottom: 30px;
            position: relative;
        }
        
        .article-category {
            display: inline-block;
            background: rgba(161, 136, 127, 0.15);
            color: #8d6e63;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 20px;
        }
        
        .article-title {
            font-size: 32px;
            font-weight: 700;
            color: #5d4037;
            line-height: 1.3;
            margin-bottom: 20px;
            padding-right: 60px;
        }
        
        .add-to-bookshelf {
            position: absolute;
            top: 5px;
            right: 0;
            background: rgba(188, 170, 164, 0.15);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            color: #5d4037;
            font-size: 22px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .add-to-bookshelf:hover {
            background: rgba(188, 170, 164, 0.25);
            color: #8d6e63;
            transform: scale(1.1);
        }
        
        .add-to-bookshelf.active {
            background: rgba(161, 136, 127, 0.2);
            color: #8d6e63;
        }
        
        .add-to-bookshelf.active i {
            transform: scale(1.2);
        }
        
        .article-meta {
            display: flex;
            align-items: center;
            gap: 20px;
            color: #8d6e63;
            font-size: 14px;
        }
        
        .article-author {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .author-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: url('https://files.catbox.moe/t020th.png') no-repeat center center;
            background-size: cover;
        }
        
        .article-body {
            line-height: 1.8;
            font-size: 17px;
        }
        
        .article-body p {
            margin-bottom: 25px;
            color: #3a332e;
        }
        
        .article-body h3 {
            color: #8d6e63;
            margin: 35px 0 20px;
            font-size: 24px;
        }
        
        /* 书架页面 */
        .bookshelf-container {
            background: rgba(255, 253, 250, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(188, 170, 164, 0.25);
            border: 1px solid rgba(255, 253, 250, 0.3);
            margin-top: 30px;
        }
        
        .bookshelf-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }
        
        .bookshelf-title {
            font-size: 32px;
            font-weight: 700;
            color: #8d6e63;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .bookshelf-title i {
            font-size: 36px;
        }
        
        .bookshelf-controls {
            display: flex;
            gap: 15px;
        }
        
        .bookshelf-btn {
            background: rgba(161, 136, 127, 0.15);
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            color: #8d6e63;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .bookshelf-btn:hover {
            background: rgba(161, 136, 127, 0.25);
            transform: translateY(-2px);
        }
        
        .bookshelf-btn.clear {
            background: rgba(171, 130, 110, 0.15);
            color: #5d4037;
        }
        
        .bookshelf-btn.clear:hover {
            background: rgba(171, 130, 110, 0.25);
        }
        
        .bookshelf-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(188, 170, 164, 0.3);
            padding-bottom: 15px;
        }
        
        .bookshelf-tab {
            background: none;
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            color: #5d4037;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .bookshelf-tab:hover {
            background: rgba(161, 136, 127, 0.1);
        }
        
        .bookshelf-tab.active {
            background: rgba(161, 136, 127, 0.15);
            color: #8d6e63;
        }
        
        .bookshelf-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
        }
        
        .book-item {
            background: rgba(255, 253, 250, 0.9);
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(188, 170, 164, 0.25);
            transition: all 0.3s;
            border: 1px solid rgba(255, 253, 250, 0.4);
        }
        
        .book-item:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 35px rgba(188, 170, 164, 0.35);
        }
        
        .book-cover {
            height: 180px;
            background: linear-gradient(135deg, #a1887f, #bcaaa4);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 50px;
            position: relative;
        }
        
        .book-category {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(255, 253, 250, 0.95);
            color: #8d6e63;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .book-content {
            padding: 25px;
        }
        
        .book-title {
            font-size: 20px;
            font-weight: 700;
            color: #5d4037;
            margin-bottom: 10px;
            line-height: 1.4;
        }
        
        .book-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 13px;
            color: #8d6e63;
        }
        
        .book-author {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .book-author-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: url('https://files.catbox.moe/t020th.png') no-repeat center center;
            background-size: cover;
        }
        
        .book-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .book-action-btn {
            background: none;
            border: none;
            color: #bcaaa4;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s;
            padding: 8px;
            border-radius: 10px;
        }
        
        .book-action-btn:hover {
            color: #8d6e63;
            background: rgba(161, 136, 127, 0.1);
        }
        
        .book-progress {
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .progress-bar-small {
            flex-grow: 1;
            height: 6px;
            background: rgba(161, 136, 127, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #8d6e63, #bcaaa4);
            border-radius: 3px;
        }
        
        .progress-text {
            font-size: 12px;
            color: #8d6e63;
            font-weight: 600;
            min-width: 40px;
        }
        
        .empty-bookshelf {
            text-align: center;
            padding: 60px 20px;
            color: #8d6e63;
        }
        
        .empty-bookshelf i {
            font-size: 60px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-bookshelf h3 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #5d4037;
        }
        
        .empty-bookshelf p {
            margin-bottom: 30px;
        }
        
        .empty-action {
            display: inline-block;
            background: rgba(161, 136, 127, 0.15);
            color: #8d6e63;
            padding: 12px 30px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .empty-action:hover {
            background: rgba(161, 136, 127, 0.25);
            transform: translateY(-3px);
        }
        
        /* 侧边栏 */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .widget {
            background: rgba(255, 253, 250, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(188, 170, 164, 0.25);
            border: 1px solid rgba(255, 253, 250, 0.3);
        }
        
        .widget-title {
            font-size: 20px;
            font-weight: 700;
            color: #8d6e63;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .widget-title i {
            font-size: 22px;
        }
        
        .recommended-articles {
            list-style: none;
        }
        
        .recommended-item {
            padding: 15px 0;
            border-bottom: 1px solid rgba(188, 170, 164, 0.5);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .recommended-item:last-child {
            border-bottom: none;
        }
        
        .recommended-cover {
            width: 70px;
            height: 70px;
            border-radius: 15px;
            background: linear-gradient(135deg, #bcaaa4, #d7ccc8);
            flex-shrink: 0;
        }
        
        .recommended-content h4 {
            font-size: 16px;
            color: #5d4037;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .recommended-content p {
            font-size: 13px;
            color: #8d6e63;
        }
        
        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .tag {
            background: rgba(188, 170, 164, 0.15);
            color: #5d4037;
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 14px;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .tag:hover {
            background: rgba(188, 170, 164, 0.25);
            transform: translateY(-2px);
        }
        
        /* 绯&tin日常 - 日记功能 */
        .daily-container {
            background: rgba(255, 253, 250, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(188, 170, 164, 0.25);
            border: 1px solid rgba(255, 253, 250, 0.3);
            margin-top: 30px;
        }
        
        .daily-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .daily-title {
            font-size: 32px;
            font-weight: 700;
            color: #8d6e63;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .daily-title i {
            font-size: 36px;
        }
        
        .add-diary-btn {
            background: rgba(161, 136, 127, 0.15);
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            color: #8d6e63;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .add-diary-btn:hover {
            background: rgba(161, 136, 127, 0.25);
            transform: translateY(-2px);
        }
        
        .diary-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            flex: 1;
            background: rgba(255, 253, 250, 0.95);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(188, 170, 164, 0.2);
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(188, 170, 164, 0.3);
        }
        
        .stat-number {
            font-size: 36px;
            font-weight: 700;
            color: #8d6e63;
            margin-bottom: 10px;
        }
        
        .stat-label {
            font-size: 16px;
            color: #5d4037;
        }
        
        .diary-calendar {
            background: rgba(255, 253, 250, 0.95);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(188, 170, 164, 0.2);
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-month {
            font-size: 20px;
            font-weight: 700;
            color: #5d4037;
        }
        
        .calendar-controls {
            display: flex;
            gap: 10px;
        }
        
        .calendar-controls button {
            background: rgba(161, 136, 127, 0.15);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: #8d6e63;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .calendar-controls button:hover {
            background: rgba(161, 136, 127, 0.25);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }
        
        .calendar-day {
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-weight: 500;
            color: #5d4037;
        }
        
        .calendar-day.header {
            font-weight: 700;
            color: #8d6e63;
        }
        
        .calendar-day.has-entry {
            background: rgba(161, 136, 127, 0.15);
            cursor: pointer;
        }
        
        .calendar-day.has-entry:hover {
            background: rgba(161, 136, 127, 0.25);
        }
        
        .calendar-day.today {
            background: rgba(161, 136, 127, 0.25);
            color: #5d4037;
            font-weight: 700;
        }
        
        .diary-entries {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .diary-entry {
            background: rgba(255, 253, 250, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(188, 170, 164, 0.2);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .diary-entry:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(188, 170, 164, 0.3);
        }
        
        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .entry-date {
            font-size: 18px;
            font-weight: 700;
            color: #8d6e63;
        }
        
        .entry-mood {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .mood-happy {
            background: rgba(255, 193, 7, 0.15);
            color: #ff9800;
        }
        
        .mood-neutral {
            background: rgba(158, 158, 158, 0.15);
            color: #757575;
        }
        
        .mood-sad {
            background: rgba(33, 150, 243, 0.15);
            color: #2196f3;
        }
        
        .entry-title {
            font-size: 22px;
            font-weight: 700;
            color: #5d4037;
            margin-bottom: 10px;
        }
        
        .entry-preview {
            color: #8d6e63;
            line-height: 1.6;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .entry-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .entry-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .entry-tag {
            background: rgba(188, 170, 164, 0.15);
            color: #5d4037;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
        }
        
        .entry-actions {
            display: flex;
            gap: 10px;
        }
        
        .entry-action-btn {
            background: none;
            border: none;
            color: #bcaaa4;
            font-size: 16px;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.2s;
        }
        
        .entry-action-btn:hover {
            color: #8d6e63;
            background: rgba(161, 136, 127, 0.1);
        }
        
        /* 日记模态框 */
        .diary-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s;
        }
        
        .diary-modal.active {
            display: flex;
            opacity: 1;
        }
        
        .diary-modal-content {
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            background: white;
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            transition: transform 0.3s;
            display: flex;
            flex-direction: column;
        }
        
        .diary-modal.active .diary-modal-content {
            transform: translateY(0);
        }
        
        .modal-header {
            background: rgba(161, 136, 127, 0.1);
            padding: 25px 30px;
            border-bottom: 1px solid rgba(188, 170, 164, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #5d4037;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #8d6e63;
            cursor: pointer;
            transition: all 0.2s;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-close:hover {
            background: rgba(161, 136, 127, 0.1);
        }
        
        .modal-body {
            padding: 30px;
            flex-grow: 1;
            overflow-y: auto;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #5d4037;
        }
        
        .form-input, .form-textarea {
            width: 100%;
            padding: 15px;
            border: 1px solid rgba(188, 170, 164, 0.5);
            border-radius: 15px;
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 16px;
            color: #5d4037;
            background: rgba(255, 253, 250, 0.5);
            transition: all 0.3s;
        }
        
        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #8d6e63;
            box-shadow: 0 0 0 2px rgba(141, 110, 97, 0.2);
        }
        
        .form-textarea {
            min-height: 200px;
            resize: vertical;
        }
        
        .mood-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .mood-option {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border-radius: 15px;
            background: rgba(255, 253, 250, 0.5);
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .mood-option:hover {
            background: rgba(161, 136, 127, 0.1);
        }
        
        .mood-option.selected {
            border-color: #8d6e63;
            background: rgba(161, 136, 127, 0.15);
        }
        
        .mood-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .mood-happy .mood-icon {
            background: rgba(255, 193, 7, 0.15);
            color: #ff9800;
        }
        
        .mood-neutral .mood-icon {
            background: rgba(158, 158, 158, 0.15);
            color: #757575;
        }
        
        .mood-sad .mood-icon {
            background: rgba(33, 150, 243, 0.15);
            color: #2196f3;
        }
        
        .mood-name {
            font-weight: 500;
            color: #5d4037;
        }
        
        .tags-input-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            padding: 10px;
            border: 1px solid rgba(188, 170, 164, 0.5);
            border-radius: 15px;
            background: rgba(255, 253, 250, 0.5);
            min-height: 60px;
        }
        
        .tag-input {
            flex-grow: 1;
            border: none;
            padding: 10px;
            background: transparent;
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 16px;
            color: #5d4037;
            min-width: 100px;
        }
        
        .tag-input:focus {
            outline: none;
        }
        
        .tag-preview {
            background: rgba(188, 170, 164, 0.15);
            color: #5d4037;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tag-remove {
            background: none;
            border: none;
            color: #8d6e63;
            cursor: pointer;
            padding: 0;
            font-size: 12px;
        }
        
        .modal-footer {
            padding: 25px 30px;
            border-top: 1px solid rgba(188, 170, 164, 0.3);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        .modal-btn {
            padding: 12px 30px;
            border-radius: 20px;
            font-weight: 500;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }
        
        .modal-btn.cancel {
            background: rgba(188, 170, 164, 0.15);
            color: #5d4037;
        }
        
        .modal-btn.cancel:hover {
            background: rgba(188, 170, 164, 0.25);
        }
        
        .modal-btn.save {
            background: rgba(161, 136, 127, 0.2);
            color: #8d6e63;
        }
        
        .modal-btn.save:hover {
            background: rgba(161, 136, 127, 0.3);
        }
        
        .modal-btn.delete {
            background: rgba(244, 67, 54, 0.1);
            color: #f44336;
        }
        
        .modal-btn.delete:hover {
            background: rgba(244, 67, 54, 0.2);
        }
        
        /* 装饰元素 */
        .decoration {
            position: absolute;
            z-index: -1;
        }
        
        .dec-1 {
            width: 150px;
            height: 150px;
            background: linear-gradient(135deg, #d7ccc8, #a1887f);
            border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            top: 10%;
            left: 5%;
            opacity: 0.1;
        }
        
        .dec-2 {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #bcaaa4, #8d6e63);
            border-radius: 50% 20% 20% 50% / 50% 40% 60% 50%;
            bottom: 20%;
            right: 8%;
            opacity: 0.1;
        }
        
        /* 响应式设计 */
        @media (max-width: 992px) {
            .article-container {
                grid-template-columns: 1fr;
            }
            
            .nav-links {
                gap: 15px;
            }
            
            .nav-links a {
                font-size: 14px;
                padding: 6px 12px;
            }
            
            .bookshelf-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .background-list {
                grid-template-columns: 1fr;
            }
            
            .reading-grid {
                grid-template-columns: 1fr;
            }
            
            .diary-stats {
                flex-wrap: wrap;
            }
            
            .stat-card {
                min-width: calc(50% - 10px);
            }
        }
        
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                gap: 20px;
            }
            
            .article-content {
                padding: 30px 25px;
            }
            
            .article-title {
                font-size: 26px;
            }
            
            .player-panel {
                width: 300px;
                right: -20px;
            }
            
            .background-panel {
                width: 280px;
                left: -20px;
            }
            
            .bookshelf-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .bookshelf-controls {
                width: 100%;
                justify-content: space-between;
            }
            
            .background-toggle {
                bottom: 110px;
            }
            
            .reading-list-container {
                padding: 30px 25px;
            }
            
            .daily-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .add-diary-btn {
                width: 100%;
                justify-content: center;
            }
            
            .stat-card {
                min-width: 100%;
            }
            
            .mood-selector {
                flex-direction: column;
            }
        }
        
        @media (max-width: 576px) {
            .bookshelf-grid {
                grid-template-columns: 1fr;
            }
            
            .background-toggle {
                bottom: 110px;
                left: 20px;
            }
            
            .music-player {
                bottom: 30px;
                right: 20px;
            }
            
            .calendar-grid {
                gap: 5px;
            }
            
            .calendar-day {
                height: 35px;
                font-size: 14px;
            }
        }
        
        /* 动画效果 */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .logo-icon {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .book-item, .diary-entry {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body class="background-1">
    <!-- 装饰元素 -->
    <div class="decoration dec-1"></div>
    <div class="decoration dec-2"></div>
    
    <!-- 头部导航 -->
    <header>
        <div class="nav-container">
            <div class="logo">
                <div class="logo-icon"></div>
                <span>K-Bunny 阅读屋</span>
            </div>
            <nav class="nav-links">
                <a href="#" class="active" id="nav-home">首页</a>
                <a href="#" id="nav-reading">阅读</a>
                <a href="#" id="nav-bookshelf">我的书架</a>
                <a href="#" id="nav-daily">绯&tin日常</a>
                <a href="#" id="nav-collection">收藏</a>
            </nav>
        </div>
    </header>
    
    <!-- 首页内容 -->
    <main id="main-content">
        <div class="container">
            <div class="reading-list-container">
                <div class="reading-list-header">
                    <h1 class="reading-list-title">阅读列表</h1>
                    <p class="reading-list-subtitle">选择您感兴趣的文章开始阅读</p>
                </div>
                
                <div class="reading-grid">
                    <!-- 十二月的手心很冷，但是有你在 -->
                    <div class="reading-item" data-article-id="1">
                        <div class="reading-cover" style="background-image: url('https://files.catbox.moe/89qkx0.png');">
                            <div class="reading-category">情感故事</div>
                        </div>
                        <div class="reading-content">
                            <h3 class="reading-title">《十二月的手心很冷，但是有你在》</h3>
                            <div class="reading-meta">
                                <div class="reading-author">
                                    <div class="reading-author-avatar"></div>
                                    <span>memory</span>
                                </div>
                                <span>2023年12月5日</span>
                            </div>
                            <div class="reading-actions">
                                <button class="reading-action-btn start-reading-btn">
                                    <i class="fas fa-book-open"></i>
                                    开始阅读
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 滑雪 -->
                    <div class="reading-item" data-article-id="2">
                        <div class="reading-cover" style="background-image: url('https://files.catbox.moe/tek67h.png');">
                            <div class="reading-category">运动游记</div>
                        </div>
                        <div class="reading-content">
                            <h3 class="reading-title">《滑雪》</h3>
                            <div class="reading-meta">
                                <div class="reading-author">
                                    <div class="reading-author-avatar"></div>
                                    <span>memory</span>
                                </div>
                                <span>2023年1月15日</span>
                            </div>
                            <div class="reading-actions">
                                <button class="reading-action-btn start-reading-btn">
                                    <i class="fas fa-book-open"></i>
                                    开始阅读
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- 阅读页面 -->
    <div id="reading-content" class="container" style="display: none;">
        <div class="article-container">
            <article class="article-content" id="article-content">
                <!-- 文章内容将通过JavaScript动态生成 -->
            </article>
            
            <!-- 侧边栏 -->
            <aside class="sidebar">
                <!-- 推荐文章 -->
                <div class="widget">
                    <h3 class="widget-title"><i class="fas fa-heart"></i> 推荐阅读</h3>
                    <ul class="recommended-articles">
                        <li class="recommended-item" data-article-id="1">
                            <div class="recommended-cover"></div>
                            <div class="recommended-content">
                                <h4>十二月的手心很冷，但是有你在</h4>
                                <p>冬日里的温暖故事</p>
                            </div>
                        </li>
                        <li class="recommended-item" data-article-id="2">
                            <div class="recommended-cover"></div>
                            <div class="recommended-content">
                                <h4>滑雪</h4>
                                <p>雪地冒险记</p>
                            </div>
                        </li>
                    </ul>
                </div>
                
                <!-- 标签云 -->
                <div class="widget">
                    <h3 class="widget-title"><i class="fas fa-tags"></i> 热门标签</h3>
                    <div class="tags">
                        <span class="tag">情感故事</span>
                        <span class="tag">运动游记</span>
                        <span class="tag">冬日</span>
                        <span class="tag">雪地</span>
                        <span class="tag">温暖</span>
                        <span class="tag">冒险</span>
                    </div>
                </div>
            </aside>
        </div>
    </div>
    
    <!-- 书架页面 -->
    <div id="bookshelf-content" class="container" style="display: none;">
        <div class="bookshelf-container">
            <div class="bookshelf-header">
                <h1 class="bookshelf-title">
                    <i class="fas fa-books"></i>
                    我的书架
                </h1>
                <div class="bookshelf-controls">
                    <button class="bookshelf-btn" id="sort-by-date">
                        <i class="far fa-calendar-alt"></i>
                        按时间排序
                    </button>
                    <button class="bookshelf-btn" id="sort-by-title">
                        <i class="fas fa-sort-alpha-down"></i>
                        按标题排序
                    </button>
                    <button class="bookshelf-btn clear" id="clear-bookshelf">
                        <i class="fas fa-trash-alt"></i>
                        清空书架
                    </button>
                </div>
            </div>
            
            <div class="bookshelf-tabs">
                <button class="bookshelf-tab active" data-tab="all">全部书籍</button>
                <button class="bookshelf-tab" data-tab="reading">正在阅读</button>
                <button class="bookshelf-tab" data-tab="finished">已读完</button>
                <button class="bookshelf-tab" data-tab="favorites">我的最爱</button>
            </div>
            
            <div class="bookshelf-grid" id="bookshelf-grid">
                <!-- 书架内容将通过JavaScript动态生成 -->
            </div>
            
            <div class="empty-bookshelf" id="empty-bookshelf" style="display: none;">
                <i class="fas fa-book-open"></i>
                <h3>书架空空如也</h3>
                <p>快去发现精彩的文章，添加到书架中吧！</p>
                <a href="#" class="empty-action" id="go-to-home">去首页逛逛</a>
            </div>
        </div>
    </div>
    
    <!-- 绯&tin日常页面 - 日记功能 -->
    <div id="daily-content" class="container" style="display: none;">
        <div class="daily-container">
            <div class="daily-header">
                <h1 class="daily-title">
                    <i class="fas fa-feather-alt"></i>
                    绯&tin日常
                </h1>
                <button class="add-diary-btn" id="add-diary-btn">
                    <i class="fas fa-plus"></i>
                    添加日记
                </button>
            </div>
            
            <div class="diary-stats">
                <div class="stat-card">
                    <div class="stat-number" id="total-diaries">0</div>
                    <div class="stat-label">日记总数</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="this-month-diaries">0</div>
                    <div class="stat-label">本月日记</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="happy-days">0</div>
                    <div class="stat-label">开心日子</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="streak-days">0</div>
                    <div class="stat-label">连续记录</div>
                </div>
            </div>
            
            <div class="diary-calendar">
                <div class="calendar-header">
                    <div class="calendar-month" id="calendar-month">2023年12月</div>
                    <div class="calendar-controls">
                        <button id="calendar-prev"><i class="fas fa-chevron-left"></i></button>
                        <button id="calendar-today">今天</button>
                        <button id="calendar-next"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendar-grid">
                    <!-- 日历内容将通过JavaScript动态生成 -->
                </div>
            </div>
            
            <div class="diary-entries" id="diary-entries">
                <!-- 日记列表将通过JavaScript动态生成 -->
            </div>
            
            <div class="empty-bookshelf" id="empty-diary" style="display: none;">
                <i class="fas fa-feather-alt"></i>
                <h3>还没有日记记录</h3>
                <p>记录下今天的日常吧！</p>
                <button class="empty-action" id="add-first-diary">开始记录</button>
            </div>
        </div>
    </div>
    
    <!-- 日记模态框 -->
    <div class="diary-modal" id="diary-modal">
        <div class="diary-modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">添加新日记</h3>
                <button class="modal-close" id="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="diary-title">标题</label>
                    <input type="text" class="form-input" id="diary-title" placeholder="日记标题" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">心情</label>
                    <div class="mood-selector">
                        <div class="mood-option mood-happy selected" data-mood="happy">
                            <div class="mood-icon">😊</div>
                            <div class="mood-name">开心</div>
                        </div>
                        <div class="mood-option mood-neutral" data-mood="neutral">
                            <div class="mood-icon">😐</div>
                            <div class="mood-name">一般</div>
                        </div>
                        <div class="mood-option mood-sad" data-mood="sad">
                            <div class="mood-icon">😔</div>
                            <div class="mood-name">低落</div>
                        </div>
                    </div>
                    <input type="hidden" id="diary-mood" value="happy">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="diary-date">日期</label>
                    <input type="date" class="form-input" id="diary-date" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="diary-content">内容</label>
                    <textarea class="form-textarea" id="diary-content" placeholder="今天发生了什么..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">标签</label>
                    <div class="tags-input-container" id="tags-container">
                        <input type="text" class="tag-input" id="tag-input" placeholder="输入标签后按回车">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="modal-btn cancel" id="modal-cancel">取消</button>
                <button type="button" class="modal-btn delete" id="modal-delete" style="display: none;">删除</button>
                <button type="button" class="modal-btn save" id="modal-save">保存日记</button>
            </div>
        </div>
    </div>
    
    <!-- 收藏页面 -->
    <div id="collection-content" class="container" style="display: none;">
        <div class="reading-list-container">
            <div class="reading-list-header">
                <h1 class="reading-list-title">我的收藏</h1>
                <p class="reading-list-subtitle">珍藏的每一份美好</p>
            </div>
            <div class="empty-bookshelf">
                <i class="fas fa-star"></i>
                <h3>暂无收藏</h3>
                <p>快去发现精彩内容，添加到收藏中吧！</p>
            </div>
        </div>
    </div>
    
    <!-- 背景切换器 -->
    <div class="background-toggle" id="background-toggle">
        <div class="bg-btn" id="bg-btn">
            <i class="fas fa-image"></i>
        </div>
        
        <div class="background-panel" id="background-panel">
            <div class="background-header">
                <h3 class="background-title">更换背景</h3>
                <button class="background-close" id="background-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="background-list" id="background-list">
                <!-- 背景选项将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>
    
    <!-- 音乐播放器 -->
    <div class="music-player" id="music-player">
        <div class="player-btn" id="player-btn">
            <i class="fas fa-music"></i>
        </div>
        
        <div class="player-panel" id="player-panel">
            <div class="player-header">
                <h3 class="player-title">播放列表</h3>
                <button class="player-close" id="player-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="song-info">
                <div class="song-cover">
                    <i class="fas fa-headphones"></i>
                </div>
                <div class="song-details">
                    <h4 id="current-song">等待添加音乐</h4>
                    <p id="current-artist">点击下方上传音乐</p>
                </div>
            </div>
            
            <div class="player-controls">
                <button class="control-btn" id="prev-btn">
                    <i class="fas fa-step-backward"></i>
                </button>
                <button class="control-btn play-pause" id="play-pause-btn">
                    <i class="fas fa-play"></i>
                </button>
                <button class="control-btn" id="next-btn">
                    <i class="fas fa-step-forward"></i>
                </button>
            </div>
            
            <div class="progress-container" id="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            
            <div class="upload-section">
                <label for="file-input" class="upload-btn">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>上传音乐文件</span>
                </label>
                <input type="file" id="file-input" accept="audio/*" multiple>
                <div class="upload-info">支持 MP3, WAV, OGG 格式</div>
            </div>
            
            <ul class="song-list" id="song-list">
                <!-- 歌曲列表将通过JavaScript动态生成 -->
            </ul>
        </div>
    </div>
    
    <!-- 音频元素 -->
    <audio id="audio-player"></audio>
    
    <script>
        // 日记数据管理
        const diaryData = {
            load: function() {
                const data = localStorage.getItem('k-bunny-diaries');
                return data ? JSON.parse(data) : [];
            },
            
            save: function(data) {
                localStorage.setItem('k-bunny-diaries', JSON.stringify(data));
            },
            
            add: function(diary) {
                const data = this.load();
                diary.id = Date.now().toString();
                diary.createdAt = new Date().toISOString();
                diary.updatedAt = diary.createdAt;
                data.push(diary);
                this.save(data);
                return diary.id;
            },
            
            update: function(id, updates) {
                const data = this.load();
                const index = data.findIndex(item => item.id === id);
                if (index !== -1) {
                    data[index] = { ...data[index], ...updates };
                    data[index].updatedAt = new Date().toISOString();
                    this.save(data);
                    return data[index];
                }
                return null;
            },
            
            delete: function(id) {
                const data = this.load();
                const newData = data.filter(item => item.id !== id);
                this.save(newData);
                return newData;
            },
            
            get: function(id) {
                const data = this.load();
                return data.find(item => item.id === id);
            },
            
            getAll: function() {
                return this.load();
            },
            
            getByMonth: function(year, month) {
                const data = this.load();
                return data.filter(item => {
                    const date = new Date(item.date);
                    return date.getFullYear() === year && date.getMonth() === month;
                });
            },
            
            getStats: function() {
                const data = this.load();
                const today = new Date();
                const thisMonth = today.getMonth();
                const thisYear = today.getFullYear();
                
                const happyDays = data.filter(item => item.mood === 'happy').length;
                const thisMonthDiaries = data.filter(item => {
                    const date = new Date(item.date);
                    return date.getFullYear() === thisYear && date.getMonth() === thisMonth;
                }).length;
                
                let streak = 0;
                const sortedDates = data.map(item => new Date(item.date).toISOString().split('T')[0]).sort();
                
                if (sortedDates.length > 0) {
                    const todayStr = new Date().toISOString().split('T')[0];
                    let currentDate = new Date(todayStr);
                    
                    for (let i = 0; i < 365; i++) {
                        const dateStr = currentDate.toISOString().split('T')[0];
                        if (sortedDates.includes(dateStr)) {
                            streak++;
                            currentDate.setDate(currentDate.getDate() - 1);
                        } else {
                            break;
                        }
                    }
                }
                
                return {
                    total: data.length,
                    thisMonth: thisMonthDiaries,
                    happyDays: happyDays,
                    streak: streak
                };
            }
        };
        
        // 文章数据
        const articles = [
            {
                id: "1",
                title: "《十二月的手心很冷，但是有你在》",
                author: "memory",
                category: "情感故事",
                coverImage: "https://files.catbox.moe/89qkx0.png",
                date: "2023年12月5日",
                content: `
                    <div class="article-header">
                        <div class="article-category">情感故事</div>
                        <h1 class="article-title">《十二月的手心很冷，但是有你在》</h1>
                        <button class="add-to-bookshelf" id="add-to-bookshelf-btn" data-article-id="1">
                            <i class="far fa-bookmark"></i>
                        </button>
                        <div class="article-meta">
                            <div class="article-author">
                                <div class="author-avatar"></div>
                                <span>memory</span>
                            </div>
                            <span><i class="far fa-clock"></i> 2023年12月5日</span>
                            <span><i class="far fa-eye"></i> 3.2k 阅读</span>
                        </div>
                    </div>
                    
                    <div class="article-body">
                        <p>十二月的风吹过街道，带来刺骨的寒意。我缩了缩脖子，将手深深地插进大衣口袋。街角的咖啡店透出温暖的橘黄色灯光，像是一个避风的港湾。</p>
                        
                        <p>推开咖啡店的门，风铃发出清脆的响声。你坐在靠窗的位置，面前放着两杯还在冒热气的拿铁。看到我进来，你抬起头，露出一个温暖的笑容。</p>
                        
                        <p>"等很久了吗？"我走过去，脱下厚重的外套。</p>
                        
                        <p>"刚到不久。"你站起身，帮我把外套挂在椅背上。你的手不经意间触碰到我的手指，我感觉到一阵凉意。</p>
                        
                        <p>"你的手好冷。"你轻声说，然后很自然地用双手握住我的手。</p>
                        
                        <p>那一刻，时间仿佛静止了。窗外是呼啸的寒风，窗内是你的掌心温度。十二月的手心很冷，但是有你在。</p>
                    </div>
                `
            },
            {
                id: "2",
                title: "《滑雪》",
                author: "memory",
                category: "运动游记",
                coverImage: "https://files.catbox.moe/tek67h.png",
                date: "2023年1月15日",
                content: `
                    <div class="article-header">
                        <div class="article-category">运动游记</div>
                        <h1 class="article-title">《滑雪》</h1>
                        <button class="add-to-bookshelf" id="add-to-bookshelf-btn" data-article-id="2">
                            <i class="far fa-bookmark"></i>
                        </button>
                        <div class="article-meta">
                            <div class="article-author">
                                <div class="author-avatar"></div>
                                <span>memory</span>
                            </div>
                            <span><i class="far fa-clock"></i> 2023年1月15日</span>
                            <span><i class="far fa-eye"></i> 4.1k 阅读</span>
                        </div>
                    </div>
                    
                    <div class="article-body">
                        <p>清晨六点，天还没完全亮。我站在滑雪场的山顶，俯瞰着脚下绵延的雪道。整个世界一片洁白，只有几条蜿蜒的雪道像银色的丝带，点缀在这片纯净的白色画布上。</p>
                        
                        <p>这是我第一次滑雪，也是我第一次如此近距离地感受冬天的魅力。</p>
                        
                        <p>教练是个有着古铜色皮肤的中年男人，他一边帮我检查装备，一边说："滑雪最重要的是放松，当你与雪融为一体时，你就会飞起来。"</p>
                        
                        <p>我点点头，心里却紧张得像拉满的弓弦。</p>
                    </div>
                `
            }
        ];
        
        // 书架数据管理
        const bookshelfData = {
            load: function() {
                const data = localStorage.getItem('k-bunny-bookshelf');
                return data ? JSON.parse(data) : [];
            },
            
            save: function(data) {
                localStorage.setItem('k-bunny-bookshelf', JSON.stringify(data));
            },
            
            add: function(article) {
                const data = this.load();
                const existingIndex = data.findIndex(item => item.id === article.id);
                
                if (existingIndex === -1) {
                    article.addedDate = new Date().toISOString();
                    article.readProgress = 0;
                    article.isFavorite = false;
                    article.status = 'reading';
                    data.push(article);
                    this.save(data);
                    return true;
                }
                return false;
            },
            
            remove: function(articleId) {
                const data = this.load();
                const newData = data.filter(item => item.id !== articleId);
                this.save(newData);
                return newData;
            },
            
            update: function(articleId, updates) {
                const data = this.load();
                const index = data.findIndex(item => item.id === articleId);
                
                if (index !== -1) {
                    data[index] = { ...data[index], ...updates };
                    this.save(data);
                    return data[index];
                }
                return null;
            },
            
            contains: function(articleId) {
                const data = this.load();
                return data.some(item => item.id === articleId);
            },
            
            get: function(articleId) {
                const data = this.load();
                return data.find(item => item.id === articleId);
            }
        };
        
        // 页面元素
        const mainContent = document.getElementById('main-content');
        const readingContent = document.getElementById('reading-content');
        const bookshelfContent = document.getElementById('bookshelf-content');
        const dailyContent = document.getElementById('daily-content');
        const collectionContent = document.getElementById('collection-content');
        
        // 导航栏元素
        const navHome = document.getElementById('nav-home');
        const navReading = document.getElementById('nav-reading');
        const navBookshelf = document.getElementById('nav-bookshelf');
        const navDaily = document.getElementById('nav-daily');
        const navCollection = document.getElementById('nav-collection');
        
        // 其他元素
        const articleContent = document.getElementById('article-content');
        const bookshelfGrid = document.getElementById('bookshelf-grid');
        const emptyBookshelf = document.getElementById('empty-bookshelf');
        const goToHomeBtn = document.getElementById('go-to-home');
        const bookshelfTabs = document.querySelectorAll('.bookshelf-tab');
        const sortByDateBtn = document.getElementById('sort-by-date');
        const sortByTitleBtn = document.getElementById('sort-by-title');
        const clearBookshelfBtn = document.getElementById('clear-bookshelf');
        
        // 背景切换器元素
        const bgToggle = document.getElementById('background-toggle');
        const bgBtn = document.getElementById('bg-btn');
        const backgroundPanel = document.getElementById('background-panel');
        const backgroundClose = document.getElementById('background-close');
        
        // 音乐播放器元素
        const musicPlayer = document.getElementById('music-player');
        const playerBtn = document.getElementById('player-btn');
        const playerPanel = document.getElementById('player-panel');
        const playerClose = document.getElementById('player-close');
        
        // 日记相关元素
        const addDiaryBtn = document.getElementById('add-diary-btn');
        const addFirstDiaryBtn = document.getElementById('add-first-diary');
        const diaryModal = document.getElementById('diary-modal');
        const modalClose = document.getElementById('modal-close');
        const modalCancel = document.getElementById('modal-cancel');
        const modalSave = document.getElementById('modal-save');
        const modalDelete = document.getElementById('modal-delete');
        const modalTitle = document.getElementById('modal-title');
        const diaryTitle = document.getElementById('diary-title');
        const diaryDate = document.getElementById('diary-date');
        const diaryMood = document.getElementById('diary-mood');
        const diaryContent = document.getElementById('diary-content');
        const tagInput = document.getElementById('tag-input');
        const tagsContainer = document.getElementById('tags-container');
        const moodOptions = document.querySelectorAll('.mood-option');
        const diaryEntries = document.getElementById('diary-entries');
        const emptyDiary = document.getElementById('empty-diary');
        
        // 日历相关元素
        const calendarMonth = document.getElementById('calendar-month');
        const calendarGrid = document.getElementById('calendar-grid');
        const calendarPrev = document.getElementById('calendar-prev');
        const calendarNext = document.getElementById('calendar-next');
        const calendarToday = document.getElementById('calendar-today');
        
        // 统计元素
        const totalDiaries = document.getElementById('total-diaries');
        const thisMonthDiaries = document.getElementById('this-month-diaries');
        const happyDays = document.getElementById('happy-days');
        const streakDays = document.getElementById('streak-days');
        
        // 音频播放器元素
        const audioPlayer = document.getElementById('audio-player');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressContainer = document.getElementById('progress-container');
        const progressBar = document.getElementById('progress-bar');
        const currentSongEl = document.getElementById('current-song');
        const currentArtistEl = document.getElementById('current-artist');
        const songListEl = document.getElementById('song-list');
        const fileInput = document.getElementById('file-input');
        
        // 当前阅读的文章ID
        let currentArticleId = null;
        
        // 当前编辑的日记ID
        let currentDiaryId = null;
        
        // 日历当前显示的日期
        let calendarCurrentDate = new Date();
        
        // 音乐播放器变量
        let songs = [];
        let currentSongIndex = 0;
        let isPlaying = false;
        
        // 背景管理
        const backgroundManager = {
            backgrounds: [
                {
                    id: 'default-bg',
                    name: '默认斑点',
                    type: 'default',
                    icon: 'fas fa-dot-circle'
                },
                {
                    id: 'background-1',
                    name: '梦幻花园',
                    type: 'image',
                    url: 'https://files.catbox.moe/nm0xpd.jpg'
                },
                {
                    id: 'background-2',
                    name: '可爱云朵',
                    type: 'image',
                    url: 'https://files.catbox.moe/h5u246.jpg'
                },
                {
                    id: 'background-3',
                    name: '温馨房间',
                    type: 'image',
                    url: 'https://files.catbox.moe/e4e0eq.jpg'
                }
            ],
            
            init: function() {
                const currentBackground = localStorage.getItem('k-bunny-background') || 'background-1';
                this.setBackground(currentBackground);
                this.renderBackgroundList(currentBackground);
            },
            
            setBackground: function(backgroundId) {
                const body = document.body;
                body.classList.remove('default-bg', 'background-1', 'background-2', 'background-3');
                body.classList.add(backgroundId);
                localStorage.setItem('k-bunny-background', backgroundId);
                this.updateActiveBackground(backgroundId);
            },
            
            renderBackgroundList: function(currentBackgroundId) {
                const backgroundList = document.getElementById('background-list');
                backgroundList.innerHTML = '';
                
                this.backgrounds.forEach(background => {
                    const bgItem = document.createElement('div');
                    bgItem.className = `background-item ${background.id === currentBackgroundId ? 'active' : ''}`;
                    bgItem.setAttribute('data-bg-id', background.id);
                    
                    if (background.type === 'default') {
                        bgItem.innerHTML = `
                            <div class="background-preview default-bg">
                                <i class="${background.icon}"></i>
                            </div>
                            <div class="background-name">${background.name}</div>
                        `;
                    } else {
                        bgItem.innerHTML = `
                            <img src="${background.url}" alt="${background.name}" class="background-preview">
                            <div class="background-name">${background.name}</div>
                        `;
                    }
                    
                    bgItem.addEventListener('click', () => {
                        this.setBackground(background.id);
                        showNotification(`背景已更换为: ${background.name}`);
                    });
                    
                    backgroundList.appendChild(bgItem);
                });
            },
            
            updateActiveBackground: function(backgroundId) {
                document.querySelectorAll('.background-item').forEach(item => {
                    if (item.getAttribute('data-bg-id') === backgroundId) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
            }
        };
        
        // 切换页面视图
        function showPage(page) {
            mainContent.style.display = 'none';
            readingContent.style.display = 'none';
            bookshelfContent.style.display = 'none';
            dailyContent.style.display = 'none';
            collectionContent.style.display = 'none';
            
            navHome.classList.remove('active');
            navReading.classList.remove('active');
            navBookshelf.classList.remove('active');
            navDaily.classList.remove('active');
            navCollection.classList.remove('active');
            
            if (page === 'home') {
                mainContent.style.display = 'block';
                navHome.classList.add('active');
            } else if (page === 'reading') {
                readingContent.style.display = 'block';
                navReading.classList.add('active');
                
                if (!currentArticleId) {
                    showArticle('1');
                }
            } else if (page === 'bookshelf') {
                bookshelfContent.style.display = 'block';
                navBookshelf.classList.add('active');
                renderBookshelf('all');
            } else if (page === 'daily') {
                dailyContent.style.display = 'block';
                navDaily.classList.add('active');
                renderDiaryPage();
            } else if (page === 'collection') {
                collectionContent.style.display = 'block';
                navCollection.classList.add('active');
            }
        }
        
        // 显示文章
        function showArticle(articleId) {
            const article = articles.find(a => a.id === articleId);
            if (!article) return;
            
            currentArticleId = articleId;
            articleContent.innerHTML = article.content;
            
            initBookshelfButton();
            
            document.querySelectorAll('.recommended-item').forEach(item => {
                item.addEventListener('click', () => {
                    const recArticleId = item.getAttribute('data-article-id');
                    showArticle(recArticleId);
                });
            });
            
            const addToBookshelfBtn = document.getElementById('add-to-bookshelf-btn');
            if (addToBookshelfBtn) {
                addToBookshelfBtn.addEventListener('click', () => {
                    toggleBookshelf(articleId);
                });
            }
        }
        
        // 初始化书架按钮状态
        function initBookshelfButton() {
            if (!currentArticleId) return;
            
            const addToBookshelfBtn = document.getElementById('add-to-bookshelf-btn');
            if (!addToBookshelfBtn) return;
            
            const isInBookshelf = bookshelfData.contains(currentArticleId);
            
            if (isInBookshelf) {
                addToBookshelfBtn.classList.add('active');
                addToBookshelfBtn.innerHTML = '<i class="fas fa-bookmark"></i>';
            } else {
                addToBookshelfBtn.classList.remove('active');
                addToBookshelfBtn.innerHTML = '<i class="far fa-bookmark"></i>';
            }
        }
        
        // 切换添加/移除书架
        function toggleBookshelf(articleId) {
            const article = articles.find(a => a.id === articleId);
            
            if (!article) return;
            
            const isInBookshelf = bookshelfData.contains(articleId);
            
            if (isInBookshelf) {
                bookshelfData.remove(articleId);
                showNotification('文章已从书架移除！');
                
                if (bookshelfContent.style.display !== 'none') {
                    renderBookshelf('all');
                }
            } else {
                const success = bookshelfData.add(article);
                if (success) {
                    showNotification('文章已添加到书架！');
                }
            }
            
            initBookshelfButton();
        }
        
        // 渲染书架
        function renderBookshelf(filter = 'all') {
            let bookshelfItems = bookshelfData.load();
            
            if (filter === 'reading') {
                bookshelfItems = bookshelfItems.filter(item => item.status === 'reading');
            } else if (filter === 'finished') {
                bookshelfItems = bookshelfItems.filter(item => item.status === 'finished');
            } else if (filter === 'favorites') {
                bookshelfItems = bookshelfItems.filter(item => item.isFavorite);
            }
            
            if (bookshelfItems.length === 0) {
                bookshelfGrid.style.display = 'none';
                emptyBookshelf.style.display = 'block';
            } else {
                bookshelfGrid.style.display = 'grid';
                emptyBookshelf.style.display = 'none';
                bookshelfGrid.innerHTML = '';
                
                bookshelfItems.forEach((item, index) => {
                    const bookElement = document.createElement('div');
                    bookElement.className = 'book-item';
                    bookElement.setAttribute('data-article-id', item.id);
                    
                    if (!item.readProgress && item.readProgress !== 0) {
                        item.readProgress = Math.floor(Math.random() * 100);
                        bookshelfData.update(item.id, { readProgress: item.readProgress });
                    }
                    
                    bookElement.innerHTML = `
                        <div class="book-cover" style="background: linear-gradient(135deg, #a1887f, #bcaaa4)">
                            <div class="book-category">${item.category || '未分类'}</div>
                            <i class="fas fa-book-open"></i>
                        </div>
                        <div class="book-content">
                            <h3 class="book-title">${item.title}</h3>
                            <div class="book-meta">
                                <div class="book-author">
                                    <div class="book-author-avatar"></div>
                                    <span>${item.author}</span>
                                </div>
                                <span>${item.date || '未知日期'}</span>
                            </div>
                            <div class="book-progress">
                                <div class="progress-bar-small">
                                    <div class="progress-fill" style="width: ${item.readProgress || 0}%"></div>
                                </div>
                                <div class="progress-text">${item.readProgress || 0}%</div>
                            </div>
                            <div class="book-actions">
                                <button class="book-action-btn favorite-btn" title="${item.isFavorite ? '取消收藏' : '加入收藏'}">
                                    <i class="${item.isFavorite ? 'fas' : 'far'} fa-heart"></i>
                                </button>
                                <button class="book-action-btn read-btn" title="${item.status === 'finished' ? '标记为未读' : '标记为已读'}">
                                    <i class="fas fa-${item.status === 'finished' ? 'check-circle' : 'book-reader'}"></i>
                                </button>
                                <button class="book-action-btn delete-btn" title="从书架移除">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    
                    bookshelfGrid.appendChild(bookElement);
                });
                
                document.querySelectorAll('.book-item').forEach(item => {
                    const articleId = item.getAttribute('data-article-id');
                    
                    item.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('book-action-btn')) {
                            currentArticleId = articleId;
                            showPage('reading');
                            showArticle(articleId);
                        }
                    });
                    
                    const favoriteBtn = item.querySelector('.favorite-btn');
                    favoriteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const bookData = bookshelfData.get(articleId);
                        if (bookData) {
                            const newFavoriteState = !bookData.isFavorite;
                            bookshelfData.update(articleId, { isFavorite: newFavoriteState });
                            const heartIcon = favoriteBtn.querySelector('i');
                            heartIcon.className = newFavoriteState ? 'fas fa-heart' : 'far fa-heart';
                            favoriteBtn.title = newFavoriteState ? '取消收藏' : '加入收藏';
                            showNotification(newFavoriteState ? '已加入收藏！' : '已取消收藏！');
                            const activeTab = document.querySelector('.bookshelf-tab.active').getAttribute('data-tab');
                            if (activeTab === 'favorites') {
                                renderBookshelf('favorites');
                            }
                        }
                    });
                    
                    const readBtn = item.querySelector('.read-btn');
                    readBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const bookData = bookshelfData.get(articleId);
                        if (bookData) {
                            const newStatus = bookData.status === 'finished' ? 'reading' : 'finished';
                            bookshelfData.update(articleId, { 
                                status: newStatus,
                                readProgress: newStatus === 'finished' ? 100 : bookData.readProgress
                            });
                            const readIcon = readBtn.querySelector('i');
                            readIcon.className = newStatus === 'finished' ? 'fas fa-check-circle' : 'fas fa-book-reader';
                            readBtn.title = newStatus === 'finished' ? '标记为未读' : '标记为已读';
                            const progressFill = item.querySelector('.progress-fill');
                            const progressText = item.querySelector('.progress-text');
                            progressFill.style.width = newStatus === 'finished' ? '100%' : `${bookData.readProgress}%`;
                            progressText.textContent = newStatus === 'finished' ? '100%' : `${bookData.readProgress}%`;
                            showNotification(newStatus === 'finished' ? '标记为已读！' : '标记为未读！');
                            const activeTab = document.querySelector('.bookshelf-tab.active').getAttribute('data-tab');
                            if (activeTab === 'reading' || activeTab === 'finished') {
                                renderBookshelf(activeTab);
                            }
                        }
                    });
                    
                    const deleteBtn = item.querySelector('.delete-btn');
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (confirm('确定要从书架中移除这篇文章吗？')) {
                            bookshelfData.remove(articleId);
                            renderBookshelf(document.querySelector('.bookshelf-tab.active').getAttribute('data-tab'));
                            showNotification('已从书架移除！');
                            if (articleId === currentArticleId) {
                                initBookshelfButton();
                            }
                        }
                    });
                });
            }
        }
        
        // 渲染日记页面
        function renderDiaryPage() {
            updateDiaryStats();
            renderCalendar();
            renderDiaryEntries();
        }
        
        // 更新日记统计
        function updateDiaryStats() {
            const stats = diaryData.getStats();
            totalDiaries.textContent = stats.total;
            thisMonthDiaries.textContent = stats.thisMonth;
            happyDays.textContent = stats.happyDays;
            streakDays.textContent = stats.streak;
        }
        
        // 渲染日历
        function renderCalendar() {
            const year = calendarCurrentDate.getFullYear();
            const month = calendarCurrentDate.getMonth();
            
            const monthNames = ['一月', '二月', '三月', '四月', '五月', '六月', 
                               '七月', '八月', '九月', '十月', '十一月', '十二月'];
            calendarMonth.textContent = `${year}年${monthNames[month]}`;
            
            calendarGrid.innerHTML = '';
            
            const weekdays = ['日', '一', '二', '三', '四', '五', '六'];
            weekdays.forEach(day => {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day header';
                dayElement.textContent = day;
                calendarGrid.appendChild(dayElement);
            });
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const firstDayOfWeek = firstDay.getDay();
            
            const monthDiaries = diaryData.getByMonth(year, month);
            const diaryDates = monthDiaries.map(diary => new Date(diary.date).getDate());
            
            const today = new Date();
            const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;
            const todayDate = today.getDate();
            
            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendarGrid.appendChild(emptyDay);
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                if (diaryDates.includes(day)) {
                    dayElement.classList.add('has-entry');
                    dayElement.addEventListener('click', () => {
                        const diary = monthDiaries.find(d => new Date(d.date).getDate() === day);
                        if (diary) {
                            openDiaryModal(diary.id);
                        }
                    });
                }
                
                if (isCurrentMonth && day === todayDate) {
                    dayElement.classList.add('today');
                }
                
                calendarGrid.appendChild(dayElement);
            }
        }
        
        // 渲染日记列表
        function renderDiaryEntries() {
            const diaries = diaryData.getAll();
            
            if (diaries.length === 0) {
                diaryEntries.style.display = 'none';
                emptyDiary.style.display = 'block';
            } else {
                diaryEntries.style.display = 'flex';
                emptyDiary.style.display = 'none';
                diaryEntries.innerHTML = '';
                
                diaries.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                diaries.forEach(diary => {
                    const entryElement = document.createElement('div');
                    entryElement.className = 'diary-entry';
                    entryElement.setAttribute('data-diary-id', diary.id);
                    
                    const date = new Date(diary.date);
                    const formattedDate = `${date.getFullYear()}年${date.getMonth() + 1}月${date.getDate()}日`;
                    
                    let moodEmoji = '😐';
                    if (diary.mood === 'happy') moodEmoji = '😊';
                    else if (diary.mood === 'sad') moodEmoji = '😔';
                    
                    const preview = diary.content.length > 100 
                        ? diary.content.substring(0, 100) + '...' 
                        : diary.content;
                    
                    entryElement.innerHTML = `
                        <div class="entry-header">
                            <div class="entry-date">${formattedDate}</div>
                            <div class="entry-mood mood-${diary.mood}">${moodEmoji}</div>
                        </div>
                        <h3 class="entry-title">${diary.title}</h3>
                        <div class="entry-preview">${preview}</div>
                        <div class="entry-footer">
                            <div class="entry-tags">
                                ${diary.tags && diary.tags.length > 0 
                                    ? diary.tags.map(tag => `<span class="entry-tag">${tag}</span>`).join('') 
                                    : '<span class="entry-tag">无标签</span>'}
                            </div>
                            <div class="entry-actions">
                                <button class="entry-action-btn edit-btn" title="编辑">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="entry-action-btn delete-btn" title="删除">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    
                    diaryEntries.appendChild(entryElement);
                    
                    entryElement.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('entry-action-btn') && 
                            !e.target.closest('.entry-action-btn')) {
                            openDiaryModal(diary.id);
                        }
                    });
                    
                    const editBtn = entryElement.querySelector('.edit-btn');
                    editBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        openDiaryModal(diary.id, true);
                    });
                    
                    const deleteBtn = entryElement.querySelector('.delete-btn');
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (confirm('确定要删除这篇日记吗？')) {
                            diaryData.delete(diary.id);
                            renderDiaryPage();
                            showNotification('日记已删除！');
                        }
                    });
                });
            }
        }
        
        // 打开日记模态框
        function openDiaryModal(diaryId = null, isEditing = false) {
            currentDiaryId = diaryId;
            
            // 重置表单
            diaryTitle.value = '';
            diaryContent.value = '';
            
            // 设置默认日期为今天
            const today = new Date().toISOString().split('T')[0];
            diaryDate.value = today;
            
            // 重置心情选择
            moodOptions.forEach(option => option.classList.remove('selected'));
            document.querySelector('.mood-option[data-mood="happy"]').classList.add('selected');
            diaryMood.value = 'happy';
            
            // 清空标签
            tagsContainer.innerHTML = '<input type="text" class="tag-input" id="tag-input" placeholder="输入标签后按回车">';
            
            if (diaryId) {
                const diary = diaryData.get(diaryId);
                if (diary) {
                    modalTitle.textContent = '编辑日记';
                    diaryTitle.value = diary.title;
                    diaryDate.value = diary.date;
                    diaryContent.value = diary.content;
                    diaryMood.value = diary.mood;
                    
                    moodOptions.forEach(option => {
                        option.classList.remove('selected');
                        if (option.getAttribute('data-mood') === diary.mood) {
                            option.classList.add('selected');
                        }
                    });
                    
                    if (diary.tags && diary.tags.length > 0) {
                        diary.tags.forEach(tag => {
                            addTagToInput(tag);
                        });
                    }
                    
                    modalDelete.style.display = 'block';
                }
            } else {
                modalTitle.textContent = '添加新日记';
                modalDelete.style.display = 'none';
            }
            
            // 显示模态框
            diaryModal.classList.add('active');
            
            // 重新绑定标签输入事件
            const newTagInput = document.getElementById('tag-input');
            newTagInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ',') {
                    e.preventDefault();
                    if (this.value.trim()) {
                        addTagToInput(this.value.trim());
                        this.value = '';
                    }
                }
            });
            
            newTagInput.addEventListener('blur', function() {
                if (this.value.trim()) {
                    addTagToInput(this.value.trim());
                    this.value = '';
                }
            });
        }
        
        // 添加标签到输入框
        function addTagToInput(tagText) {
            if (!tagText.trim()) return;
            
            const tagElement = document.createElement('div');
            tagElement.className = 'tag-preview';
            tagElement.innerHTML = `
                ${tagText}
                <button class="tag-remove">×</button>
            `;
            
            const removeBtn = tagElement.querySelector('.tag-remove');
            removeBtn.addEventListener('click', () => {
                tagsContainer.removeChild(tagElement);
            });
            
            const tagInput = document.getElementById('tag-input');
            tagsContainer.insertBefore(tagElement, tagInput);
        }
        
        // 关闭日记模态框
        function closeDiaryModal() {
            diaryModal.classList.remove('active');
            currentDiaryId = null;
        }
        
        // 保存日记
        function saveDiary() {
            if (!diaryTitle.value.trim()) {
                alert('请输入日记标题');
                return;
            }
            
            if (!diaryContent.value.trim()) {
                alert('请输入日记内容');
                return;
            }
            
            // 收集标签
            const tags = [];
            document.querySelectorAll('.tag-preview').forEach(tagElement => {
                const tagText = tagElement.textContent.replace('×', '').trim();
                if (tagText) tags.push(tagText);
            });
            
            const diary = {
                title: diaryTitle.value.trim(),
                date: diaryDate.value,
                content: diaryContent.value.trim(),
                mood: diaryMood.value,
                tags: tags
            };
            
            if (currentDiaryId) {
                diaryData.update(currentDiaryId, diary);
                showNotification('日记已更新！');
            } else {
                diaryData.add(diary);
                showNotification('日记已保存！');
            }
            
            closeDiaryModal();
            renderDiaryPage();
        }
        
        // 删除当前日记
        function deleteCurrentDiary() {
            if (currentDiaryId && confirm('确定要删除这篇日记吗？')) {
                diaryData.delete(currentDiaryId);
                closeDiaryModal();
                renderDiaryPage();
                showNotification('日记已删除！');
            }
        }
        
        // 显示通知
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 30px;
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(10px);
                color: #555;
                padding: 15px 25px;
                border-radius: 15px;
                box-shadow: 0 5px 20px rgba(100, 100, 100, 0.4);
                border: 1px solid rgba(255, 255, 255, 0.3);
                z-index: 1000;
                font-weight: 500;
                transform: translateX(100px);
                opacity: 0;
                transition: all 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
                notification.style.opacity = '1';
            }, 10);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100px)';
                notification.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // 音乐播放器功能
        const defaultSongs = [
            { name: "冬日暖阳", artist: "memory", url: "https://assets.mixkit.co/music/preview/mixkit-clear-sky-479.mp3", isDefault: true },
            { name: "雪地冒险", artist: "memory", url: "https://assets.mixkit.co/music/preview/mixkit-deep-urban-623.mp3", isDefault: true },
            { name: "十二月的心事", artist: "memory", url: "https://assets.mixkit.co/music/preview/mixkit-ambient-chill-132.mp3", isDefault: true }
        ];
        
        function initDefaultSongs() {
            songs = [...defaultSongs];
            renderSongList();
        }
        
        function renderSongList() {
            songListEl.innerHTML = '';
            
            songs.forEach((song, index) => {
                const songItem = document.createElement('li');
                songItem.className = 'song-item';
                if (index === currentSongIndex) {
                    songItem.classList.add('active');
                }
                
                songItem.innerHTML = `
                    <span class="song-name">${song.name}</span>
                    <span>--:--</span>
                    ${song.isDefault ? '' : '<button class="delete-song" data-index="' + index + '"><i class="fas fa-times"></i></button>'}
                `;
                
                songItem.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('delete-song')) {
                        playSong(index);
                    }
                });
                
                const deleteBtn = songItem.querySelector('.delete-song');
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        deleteSong(index);
                    });
                }
                
                songListEl.appendChild(songItem);
            });
        }
        
        function playSong(index) {
            if (index < 0 || index >= songs.length) return;
            
            currentSongIndex = index;
            const song = songs[currentSongIndex];
            
            audioPlayer.src = song.url;
            currentSongEl.textContent = song.name;
            currentArtistEl.textContent = song.artist;
            
            document.querySelectorAll('.song-item').forEach((item, i) => {
                if (i === currentSongIndex) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            if (isPlaying) {
                audioPlayer.play();
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            }
        }
        
        function togglePlayPause() {
            if (songs.length === 0) {
                alert('请先上传音乐文件！');
                return;
            }
            
            if (!audioPlayer.src && songs.length > 0) {
                playSong(0);
            }
            
            if (isPlaying) {
                audioPlayer.pause();
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            } else {
                audioPlayer.play();
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            }
            isPlaying = !isPlaying;
        }
        
        function prevSong() {
            if (songs.length === 0) return;
            
            currentSongIndex--;
            if (currentSongIndex < 0) {
                currentSongIndex = songs.length - 1;
            }
            playSong(currentSongIndex);
            
            if (!isPlaying) {
                audioPlayer.play();
                isPlaying = true;
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            }
        }
        
        function nextSong() {
            if (songs.length === 0) return;
            
            currentSongIndex++;
            if (currentSongIndex > songs.length - 1) {
                currentSongIndex = 0;
            }
            playSong(currentSongIndex);
            
            if (!isPlaying) {
                audioPlayer.play();
                isPlaying = true;
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            }
        }
        
        function updateProgress(e) {
            const { duration, currentTime } = e.srcElement;
            const progressPercent = (currentTime / duration) * 100;
            progressBar.style.width = `${progressPercent}%`;
        }
        
        function setProgress(e) {
            const width = this.clientWidth;
            const clickX = e.offsetX;
            const duration = audioPlayer.duration;
            
            if (duration) {
                audioPlayer.currentTime = (clickX / width) * duration;
            }
        }
        
        function songEnded() {
            nextSong();
        }
        
        function handleFileUpload(e) {
            const files = e.target.files;
            if (!files || files.length === 0) return;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                if (!file.type.startsWith('audio/')) {
                    alert(`文件 "${file.name}" 不是音频文件，已跳过`);
                    continue;
                }
                
                const url = URL.createObjectURL(file);
                
                const song = {
                    name: file.name.replace(/\.[^/.]+$/, ""),
                    artist: "上传的音乐",
                    url: url,
                    isDefault: false,
                    file: file
                };
                
                songs.push(song);
            }
            
            renderSongList();
            
            if (songs.length === files.length && !isPlaying) {
                playSong(0);
                togglePlayPause();
            }
            
            fileInput.value = '';
        }
        
        function deleteSong(index) {
            if (index < 0 || index >= songs.length) return;
            
            if (index === currentSongIndex) {
                audioPlayer.pause();
                isPlaying = false;
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                
                if (!songs[index].isDefault) {
                    URL.revokeObjectURL(songs[index].url);
                }
                
                songs.splice(index, 1);
                
                if (songs.length > 0) {
                    currentSongIndex = Math.min(index, songs.length - 1);
                    playSong(currentSongIndex);
                } else {
                    currentSongEl.textContent = "等待添加音乐";
                    currentArtistEl.textContent = "点击下方上传音乐";
                    audioPlayer.src = "";
                    progressBar.style.width = "0%";
                }
            } else {
                if (!songs[index].isDefault) {
                    URL.revokeObjectURL(songs[index].url);
                }
                
                songs.splice(index, 1);
                
                if (index < currentSongIndex) {
                    currentSongIndex--;
                }
            }
            
            renderSongList();
        }
        
        // 背景和音乐播放器拖拽功能
        function makeDraggable(element) {
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 0;
            let yOffset = 0;
            
            element.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);
            
            function dragStart(e) {
                if (e.target === bgBtn || e.target === playerBtn || 
                    e.target.closest('.bg-btn') || e.target.closest('.player-btn')) {
                    return;
                }
                
                initialX = e.clientX - xOffset;
                initialY = e.clientY - yOffset;
                
                if (e.target === element || element.contains(e.target)) {
                    isDragging = true;
                }
            }
            
            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;
                    
                    xOffset = currentX;
                    yOffset = currentY;
                    
                    element.style.transform = `translate3d(${currentX}px, ${currentY}px, 0)`;
                }
            }
            
            function dragEnd() {
                initialX = currentX;
                initialY = currentY;
                isDragging = false;
                
                const id = element.id;
                localStorage.setItem(`k-bunny-${id}-pos`, JSON.stringify({ x: xOffset, y: yOffset }));
            }
            
            const savedPos = localStorage.getItem(`k-bunny-${element.id}-pos`);
            if (savedPos) {
                const pos = JSON.parse(savedPos);
                xOffset = pos.x;
                yOffset = pos.y;
                element.style.transform = `translate3d(${pos.x}px, ${pos.y}px, 0)`;
            }
        }
        
        // 背景和音乐播放器显示/隐藏功能
        function toggleVisibility(element, button) {
            let isHidden = localStorage.getItem(`k-bunny-${element.id}-hidden`) === 'true';
            
            if (isHidden) {
                element.classList.add('hidden');
            }
            
            element.addEventListener('dblclick', () => {
                isHidden = !isHidden;
                if (isHidden) {
                    element.classList.add('hidden');
                } else {
                    element.classList.remove('hidden');
                }
                localStorage.setItem(`k-bunny-${element.id}-hidden`, isHidden);
            });
            
            if (button) {
                button.addEventListener('click', (e) => {
                    e.stopPropagation();
                    isHidden = !isHidden;
                    if (isHidden) {
                        element.classList.add('hidden');
                    } else {
                        element.classList.remove('hidden');
                    }
                    localStorage.setItem(`k-bunny-${element.id}-hidden`, isHidden);
                });
            }
        }
        
        // 初始化事件监听器
        function initEventListeners() {
            // 导航栏点击事件
            navHome.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('home');
            });
            
            navReading.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('reading');
            });
            
            navBookshelf.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('bookshelf');
            });
            
            navDaily.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('daily');
            });
            
            navCollection.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('collection');
            });
            
            // 首页阅读列表点击事件
            document.querySelectorAll('.reading-item').forEach(item => {
                item.addEventListener('click', () => {
                    const articleId = item.getAttribute('data-article-id');
                    currentArticleId = articleId;
                    showPage('reading');
                    showArticle(articleId);
                });
            });
            
            // 开始阅读按钮点击事件
            document.querySelectorAll('.start-reading-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const articleId = e.target.closest('.reading-item').getAttribute('data-article-id');
                    currentArticleId = articleId;
                    showPage('reading');
                    showArticle(articleId);
                });
            });
            
            // 书架标签切换
            bookshelfTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    bookshelfTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    const filter = tab.getAttribute('data-tab');
                    renderBookshelf(filter);
                });
            });
            
            // 排序功能
            sortByDateBtn.addEventListener('click', () => {
                showNotification('已按时间排序！');
            });
            
            sortByTitleBtn.addEventListener('click', () => {
                showNotification('已按标题排序！');
            });
            
            // 清空书架
            clearBookshelfBtn.addEventListener('click', () => {
                if (confirm('确定要清空书架吗？此操作不可恢复。')) {
                    localStorage.removeItem('k-bunny-bookshelf');
                    renderBookshelf('all');
                    initBookshelfButton();
                    showNotification('书架已清空！');
                }
            });
            
            // 返回首页按钮
            goToHomeBtn.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('home');
            });
            
            // 背景切换器事件
            bgBtn.addEventListener('click', () => {
                backgroundPanel.classList.toggle('active');
            });
            
            backgroundClose.addEventListener('click', () => {
                backgroundPanel.classList.remove('active');
            });
            
            // 音乐播放器事件
            playerBtn.addEventListener('click', () => {
                playerPanel.classList.toggle('active');
            });
            
            playerClose.addEventListener('click', () => {
                playerPanel.classList.remove('active');
            });
            
            playPauseBtn.addEventListener('click', togglePlayPause);
            prevBtn.addEventListener('click', prevSong);
            nextBtn.addEventListener('click', nextSong);
            audioPlayer.addEventListener('timeupdate', updateProgress);
            audioPlayer.addEventListener('ended', songEnded);
            progressContainer.addEventListener('click', setProgress);
            fileInput.addEventListener('change', handleFileUpload);
            
            // 日记相关事件
            addDiaryBtn.addEventListener('click', () => {
                openDiaryModal();
            });
            
            addFirstDiaryBtn.addEventListener('click', () => {
                openDiaryModal();
            });
            
            modalClose.addEventListener('click', closeDiaryModal);
            modalCancel.addEventListener('click', closeDiaryModal);
            modalSave.addEventListener('click', saveDiary);
            modalDelete.addEventListener('click', deleteCurrentDiary);
            
            // 心情选择事件
            moodOptions.forEach(option => {
                option.addEventListener('click', () => {
                    moodOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    diaryMood.value = option.getAttribute('data-mood');
                });
            });
            
            // 日历控制事件
            calendarPrev.addEventListener('click', () => {
                calendarCurrentDate.setMonth(calendarCurrentDate.getMonth() - 1);
                renderCalendar();
            });
            
            calendarNext.addEventListener('click', () => {
                calendarCurrentDate.setMonth(calendarCurrentDate.getMonth() + 1);
                renderCalendar();
            });
            
            calendarToday.addEventListener('click', () => {
                calendarCurrentDate = new Date();
                renderCalendar();
            });
            
            // 导航栏滚动效果
            window.addEventListener('scroll', () => {
                const header = document.querySelector('header');
                const navContainer = document.querySelector('.nav-container');
                
                if (window.scrollY > 20) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            });
            
            // 标签点击效果
            document.querySelectorAll('.tag').forEach(tag => {
                tag.addEventListener('click', () => {
                    document.querySelectorAll('.tag').forEach(t => t.style.backgroundColor = 'rgba(188, 170, 164, 0.15)');
                    tag.style.backgroundColor = 'rgba(161, 136, 127, 0.2)';
                    const originalText = tag.textContent;
                    tag.textContent = '✓ ' + originalText;
                    setTimeout(() => {
                        tag.textContent = originalText;
                    }, 1000);
                });
            });
        }
        
        // 初始化应用
        function initApp() {
            backgroundManager.init();
            initDefaultSongs();
            
            // 使背景切换器和音乐播放器可拖拽
            makeDraggable(bgToggle);
            makeDraggable(musicPlayer);
            
            // 添加显示/隐藏功能
            toggleVisibility(bgToggle, bgBtn);
            toggleVisibility(musicPlayer, playerBtn);
            
            // 初始化事件监听器
            initEventListeners();
            
            // 页面加载完成后显示首页
            showPage('home');
        }
        
        // 页面加载完成后初始化应用
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
